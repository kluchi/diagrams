<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="951px" preserveAspectRatio="none" style="width:845px;height:951px;" version="1.1" viewBox="0 0 845 951" width="845px" zoomAndPan="magnify"><defs><filter height="300%" id="f1tlz9f8507ngo" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[a878dacc166bb130104221e452026b76]
cluster Notifications--><polygon fill="#FFFFFF" filter="url(#f1tlz9f8507ngo)" points="22,720,126,720,133,742.2969,562,742.2969,562,883,22,883,22,720" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="22" x2="133" y1="742.2969" y2="742.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="26" y="734.9951">Notifications</text><polygon fill="#FEFECE" filter="url(#f1tlz9f8507ngo)" points="424,755,436,767,424,779,412,767,424,755" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1tlz9f8507ngo)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="244" x="38" y="833"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="224" x="48" y="854.1387">send_ws_notification(user, content)</text><rect fill="#FEFECE" filter="url(#f1tlz9f8507ngo)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="244" x="302" y="833"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="224" x="312" y="854.1387">db.store_notification(user, content)</text><ellipse cx="689" cy="18" fill="#000000" filter="url(#f1tlz9f8507ngo)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1tlz9f8507ngo)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="634.5" y="69"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="89" x="644.5" y="90.1387">request.recv()</text><rect fill="#FEFECE" filter="url(#f1tlz9f8507ngo)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="633" y="144"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="92" x="643" y="165.1387">data.validate()</text><polygon fill="#FEFECE" filter="url(#f1tlz9f8507ngo)" points="689,219,701,231,689,243,677,231,689,219" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1tlz9f8507ngo)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="576.5" y="297"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="67" x="586.5" y="318.1387">find_chat()</text><rect fill="#FEFECE" filter="url(#f1tlz9f8507ngo)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="150" x="684" y="297"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="130" x="694" y="318.1387">send_response(422)</text><polygon fill="#FEFECE" filter="url(#f1tlz9f8507ngo)" points="620,372,632,384,620,396,608,384,620,372" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1tlz9f8507ngo)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="277" x="412.5" y="525"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="257" x="422.5" y="546.1387">chats.send_message(from, to, message)</text><rect fill="#FEFECE" filter="url(#f1tlz9f8507ngo)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="590" y="450"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="106" x="600" y="471.1387">chats.save(chat)</text><rect fill="#FEFECE" filter="url(#f1tlz9f8507ngo)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="264" x="419" y="600"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="244" x="429" y="621.1387">notifications.chat_notification(from, to)</text><rect fill="#000000" filter="url(#f1tlz9f8507ngo)" height="8" style="stroke: none; stroke-width: 1.0;" width="80" x="511" y="675"/><rect fill="#FEFECE" filter="url(#f1tlz9f8507ngo)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="150" x="578" y="833"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="130" x="588" y="854.1387">send_response(201)</text><ellipse cx="567" cy="930" fill="none" filter="url(#f1tlz9f8507ngo)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="567.5" cy="930.5" fill="#000000" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><!--MD5=[dd041cf45e5e0913bf6e881bb19ba206]
link start to request.recv()--><path d="M689,28.18 C689,37.27 689,51.53 689,63.49 " fill="none" id="start-&gt;request.recv()" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="689,68.79,693,59.79,689,63.79,685,59.79,689,68.79" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[13094c1fd81334aaf163549ca7d212c1]
link request.recv() to data.validate()--><path d="M689,103.2 C689,113.69 689,127.46 689,138.82 " fill="none" id="request.recv()-&gt;data.validate()" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="689,143.84,693,134.84,689,138.84,685,134.84,689,143.84" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[2137eb966bbe44976e5e596115c876ee]
link data.validate() to #93--><path d="M689,178.12 C689,188.92 689,203.08 689,213.88 " fill="none" id="data.validate()-&gt;#93" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="689,218.89,693,209.89,689,213.89,685,209.89,689,218.89" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="68" x="604.425" y="208.468">is succesful</text><!--MD5=[ad84ef6323a55fd513a9ed6cc6928e37]
link #93 to find_chat()--><path d="M683.81,238.09 C674.02,249.58 652.43,274.93 637.07,292.96 " fill="none" id="#93-&gt;find_chat()" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="633.7,296.91,642.5771,292.6441,636.9387,293.1007,636.4821,287.4623,633.7,296.91" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="23" x="661" y="274.2104">true</text><!--MD5=[f27eae8c4d7a2ac24de68a8019fed79b]
link #93 to send_response(422)--><path d="M694.26,238.09 C704.19,249.58 726.1,274.93 741.68,292.96 " fill="none" id="#93-&gt;send_response(422)" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="745.1,296.91,742.2419,287.485,741.8308,293.1268,736.1889,292.7157,745.1,296.91" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="28" x="727" y="274.2104">false</text><!--MD5=[6ba03b8f3f4f89ea80f3824ec070ae67]
link find_chat() to #100--><path d="M620,331.12 C620,341.92 620,356.08 620,366.88 " fill="none" id="find_chat()-&gt;#100" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="620,371.89,624,362.89,620,366.89,616,362.89,620,371.89" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="40" x="570.25" y="361.468">exists?</text><!--MD5=[f0ed4cfc7323f68c1e52690aba1b36ae]
link #100 to chats.send_message(from, to, message)--><path d="M610.92,387.26 C589.24,393.21 534.63,411.54 513,450 C499.97,473.17 516.72,501.7 531.92,520.58 " fill="none" id="#100-&gt;chats.send_message(from, to, message)" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="535.33,524.69,532.662,515.2094,532.1375,520.8419,526.505,520.3174,535.33,524.69" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="65" x="514" y="471.2104">Some(chat)</text><!--MD5=[01a09924067b7f768eb88a87166451d4]
link #100 to chats.save(chat)--><path d="M623.28,393.06 C628.16,405.03 637.48,427.9 644.39,444.86 " fill="none" id="#100-&gt;chats.save(chat)" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="646.44,449.91,646.7487,440.066,644.5535,445.2795,639.34,443.0844,646.44,449.91" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="29" x="638" y="427.2104">None</text><!--MD5=[3b9554feee9f5bd2f877109ce21a3461]
link chats.save(chat) to chats.send_message(from, to, message)--><path d="M630.62,484.02 C615.05,495.16 594.22,510.07 577.77,521.84 " fill="none" id="chats.save(chat)-&gt;chats.send_message(from, to, message)" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="573.68,524.76,583.3266,522.7742,577.7458,521.8498,578.6702,516.269,573.68,524.76" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[1cab9a014152856447b6bb6a78b03e54]
link chats.send_message(from, to, message) to notifications.chat_notification(from, to)--><path d="M551,559.2 C551,569.69 551,583.46 551,594.82 " fill="none" id="chats.send_message(from, to, message)-&gt;notifications.chat_notification(from, to)" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="551,599.84,555,590.84,551,594.84,547,590.84,551,599.84" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[3a9b53bd9325a3e20f062120e028fc3c]
link notifications.chat_notification(from, to) to B1--><path d="M551,634.08 C551,645.47 551,660.3 551,669.48 " fill="none" id="notifications.chat_notification(from, to)-&gt;B1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="551,674.61,555,665.61,551,669.61,547,665.61,551,674.61" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[4e38e7cfc3caa942b6e7d4c5f24f08e0]
link B1 to send_response(201)--><path d="M552.95,683.23 C563.67,700.98 615.9,787.53 640.34,828.02 " fill="none" id="B1-&gt;send_response(201)" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="643.18,832.73,641.9411,822.9594,640.5907,828.4527,635.0974,827.1022,643.18,832.73" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[560d46b6f6793d8224e9cff1efa47d2b]
link send_response(422) to end--><path d="M759,331.21 C759,344.99 759,365.29 759,383 C759,383 759,383 759,851 C759,927.23 627.47,930.71 582.14,929.64 " fill="none" id="send_response(422)-&gt;end" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="577.05,929.49,585.9321,933.7454,582.048,929.6328,586.1606,925.7487,577.05,929.49" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[cf67889822b4c67feb1ed9ab92f371d4]
link send_response(201) to end--><path d="M635.18,867.16 C617.91,882.82 592.28,906.07 577.86,919.15 " fill="none" id="send_response(201)-&gt;end" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="574.11,922.55,583.4631,919.4647,577.8129,919.1902,578.0874,913.54,574.11,922.55" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[d8aa3c417535a28159b32a84627a1854]
link B1 to #118--><path d="M546.48,683.06 C528.44,695.28 461.26,740.77 434.8,758.68 " fill="none" id="B1-&gt;#118" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="430.64,761.5,440.3365,759.7744,434.7826,758.7002,435.8568,753.1463,430.64,761.5" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="116" x="443.972" y="757.4216">has_ws_connection?</text><!--MD5=[ec4d095c84707bdbaec42bd8202fd4da]
link #118 to send_ws_notification(user, content)--><path d="M415.52,770.6 C385.58,779.79 283.18,811.21 217.46,831.37 " fill="none" id="#118-&gt;send_ws_notification(user, content)" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="212.4,832.92,222.1749,834.1251,217.1832,831.4636,219.8447,826.472,212.4,832.92" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="23" x="316" y="810.2104">true</text><!--MD5=[c0b5ab1ba4df512ddc3b447a7d3ea9aa]
link #118 to db.store_notification(user, content)--><path d="M424,779.26 C424,791.76 424,812.21 424,827.74 " fill="none" id="#118-&gt;db.store_notification(user, content)" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="424,832.8,428,823.8,424,827.8,420,823.8,424,832.8" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="28" x="425" y="810.2104">false</text><!--MD5=[a94b8cd3214ffbbfd77d71ccb43dfed0]
link send_ws_notification(user, content) to end--><path d="M206.57,867.07 C231.63,875.21 263.23,884.69 292,891 C389.77,912.43 509.89,924.1 551.75,927.74 " fill="none" id="send_ws_notification(user, content)-&gt;end" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="556.91,928.18,548.2856,923.4239,551.9284,927.7518,547.6005,931.3945,556.91,928.18" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[df11b63a9e3799138c1a3734d9d3a377]
link db.store_notification(user, content) to end--><path d="M453.63,867.16 C484.49,883.99 531.4,909.58 553.97,921.9 " fill="none" id="db.store_notification(user, content)-&gt;end" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="558.41,924.31,552.4351,916.4806,554.0238,921.9097,548.5946,923.4985,558.41,924.31" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[8854766434cc511848913419f2e96b79]
@startuml chat_activity

(*) - -> "request.recv()"

"request.recv()" - -> "data.validate()"

"data.validate()" - -> if "is succesful" then
    - -> [true] find_chat()
else
    - -> [false] send_response(422)
endif

"find_chat()" - -> if "exists?" then

    - -> [Some(chat)] "chats.send_message(from, to, message)"

else

    - -> [None] "chats.save(chat)"

endif

"chats.save(chat)" - -> "chats.send_message(from, to, message)"

"chats.send_message(from, to, message)" - -> "notifications.chat_notification(from, to)"

"notifications.chat_notification(from, to)" - -> ===B1===

===B1=== - -> "send_response(201)"

"send_response(422)" - -> (*)
"send_response(201)" - -> (*)



partition Notifications {
    ===B1=== - ->  if "has_ws_connection?" then

    - -> [true] "send_ws_notification(user, content)"
    else

    - -> [false] "db.store_notification(user, content)"

    endif

    "send_ws_notification(user, content)" - -> (*)
    "db.store_notification(user, content)" - -> (*)

}

@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 GMT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.9+11-Ubuntu-0ubuntu1
Operating System: Linux
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>