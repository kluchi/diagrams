<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="717px" preserveAspectRatio="none" style="width:873px;height:717px;" version="1.1" viewBox="0 0 873 717" width="873px" zoomAndPan="magnify"><defs><filter height="300%" id="f18cmhyegsj8w7" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="494.9922" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="128" y="117.4297"/><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="436.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="268.5" y="146.5625"/><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="235.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="451" y="175.6953"/><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="57.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="451" y="439.8906"/><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="43.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="625.5" y="526.1563"/><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="176.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="745.5" y="204.8281"/><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="745.5" y="469.0234"/><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="133.6641" style="stroke: #000000; stroke-width: 2.0;" width="781.5" x="13" y="219.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="42" x2="42" y1="86.2969" y2="630.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="132.5" x2="132.5" y1="86.2969" y2="630.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="273.5" x2="273.5" y1="86.2969" y2="630.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="455.5" x2="455.5" y1="86.2969" y2="630.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="630.5" x2="630.5" y1="86.2969" y2="630.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="750.5" x2="750.5" y1="86.2969" y2="630.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="827.5" x2="827.5" y1="86.2969" y2="630.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="23" y="82.9951">User</text><ellipse cx="42" cy="13" fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M42,21 L42,48 M29,29 L55,29 M42,48 L29,63 M42,48 L55,63 " fill="none" filter="url(#f18cmhyegsj8w7)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="23" y="642.417">User</text><ellipse cx="42" cy="655.7188" fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M42,663.7188 L42,690.7188 M29,671.7188 L55,671.7188 M42,690.7188 L29,705.7188 M42,690.7188 L55,705.7188 " fill="none" filter="url(#f18cmhyegsj8w7)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="86.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="93.5" y="70.9951">WebServer</text><rect fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="86.5" y="629.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="93.5" y="649.417">WebServer</text><rect fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="164" x="189.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="150" x="196.5" y="70.9951">RegisterUserUsecase</text><rect fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="164" x="189.5" y="629.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="150" x="196.5" y="649.417">RegisterUserUsecase</text><rect fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="173" x="367.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="159" x="374.5" y="70.9951">PostgresUserRepoImpl</text><rect fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="173" x="367.5" y="629.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="159" x="374.5" y="649.417">PostgresUserRepoImpl</text><rect fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="554.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="561.5" y="70.9951">NotificationsService</text><rect fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="554.5" y="629.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="561.5" y="649.417">NotificationsService</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62" x="716.5" y="82.9951">Postgres</text><path d="M732.5,34 C732.5,24 750.5,24 750.5,24 C750.5,24 768.5,24 768.5,34 L768.5,60 C768.5,70 750.5,70 750.5,70 C750.5,70 732.5,70 732.5,60 L732.5,34 " fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M732.5,34 C732.5,44 750.5,44 750.5,44 C750.5,44 768.5,44 768.5,34 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62" x="716.5" y="642.417">Postgres</text><path d="M732.5,655.7188 C732.5,645.7188 750.5,645.7188 750.5,645.7188 C750.5,645.7188 768.5,645.7188 768.5,655.7188 L768.5,681.7188 C768.5,691.7188 750.5,691.7188 750.5,691.7188 C750.5,691.7188 732.5,691.7188 732.5,681.7188 L732.5,655.7188 " fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M732.5,655.7188 C732.5,665.7188 750.5,665.7188 750.5,665.7188 C750.5,665.7188 768.5,665.7188 768.5,655.7188 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><path d="M799.5,60 L856.5,60 C861.5,60 861.5,73.1484 861.5,73.1484 C861.5,73.1484 861.5,86.2969 856.5,86.2969 L799.5,86.2969 C794.5,86.2969 794.5,73.1484 794.5,73.1484 C794.5,73.1484 794.5,60 799.5,60 " fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M856.5,60 C851.5,60 851.5,73.1484 851.5,73.1484 C851.5,86.2969 856.5,86.2969 856.5,86.2969 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="799.5" y="77.9951">Queue</text><path d="M799.5,629.4219 L856.5,629.4219 C861.5,629.4219 861.5,642.5703 861.5,642.5703 C861.5,642.5703 861.5,655.7188 856.5,655.7188 L799.5,655.7188 C794.5,655.7188 794.5,642.5703 794.5,642.5703 C794.5,642.5703 794.5,629.4219 799.5,629.4219 " fill="#FEFECE" filter="url(#f18cmhyegsj8w7)" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M856.5,629.4219 C851.5,629.4219 851.5,642.5703 851.5,642.5703 C851.5,655.7188 856.5,655.7188 856.5,655.7188 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="799.5" y="647.417">Queue</text><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="494.9922" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="128" y="117.4297"/><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="436.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="268.5" y="146.5625"/><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="235.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="451" y="175.6953"/><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="57.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="451" y="439.8906"/><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="43.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="625.5" y="526.1563"/><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="176.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="745.5" y="204.8281"/><rect fill="#FFFFFF" filter="url(#f18cmhyegsj8w7)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="745.5" y="469.0234"/><polygon fill="#A80036" points="116,113.4297,126,117.4297,116,121.4297,120,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="42" x2="122" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="49" y="112.3638">POST data</text><polygon fill="#A80036" points="256.5,142.5625,266.5,146.5625,256.5,150.5625,260.5,146.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="138" x2="262.5" y1="146.5625" y2="146.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="145" y="141.4966">create_user()</text><polygon fill="#A80036" points="439,171.6953,449,175.6953,439,179.6953,443,175.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="278.5" x2="445" y1="175.6953" y2="175.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="285.5" y="170.6294">find_by_email()</text><polygon fill="#A80036" points="733.5,200.8281,743.5,204.8281,733.5,208.8281,737.5,204.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="461" x2="739.5" y1="204.8281" y2="204.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="468" y="199.7622">SELECT WHERE</text><path d="M13,219.8281 L101,219.8281 L101,226.8281 L91,236.8281 L13,236.8281 L13,219.8281 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="133.6641" style="stroke: #000000; stroke-width: 2.0;" width="781.5" x="13" y="219.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="28" y="232.895">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="209" x="116" y="232.0386">[Пользователь уже существует]</text><polygon fill="#A80036" points="472,254.0938,462,258.0938,472,262.0938,468,258.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="466" x2="744.5" y1="258.0938" y2="258.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="478" y="253.0278">1 row</text><polygon fill="#A80036" points="289.5,283.2266,279.5,287.2266,289.5,291.2266,285.5,287.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="283.5" x2="450" y1="287.2266" y2="287.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="295.5" y="282.1606">Some(user)</text><polygon fill="#FF0000" points="149,312.3594,139,316.3594,149,320.3594,145,316.3594" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="143" x2="267.5" y1="316.3594" y2="316.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="155" y="311.2935">UserExistsError</text><polygon fill="#A80036" points="53,341.4922,43,345.4922,53,349.4922,49,345.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47" x2="127" y1="345.4922" y2="345.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="59" y="340.4263">Conflict</text><polygon fill="#A80036" points="472,377.625,462,381.625,472,385.625,468,381.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="466" x2="749.5" y1="381.625" y2="381.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="478" y="376.5591">0 rows</text><polygon fill="#A80036" points="289.5,406.7578,279.5,410.7578,289.5,414.7578,285.5,410.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="283.5" x2="455" y1="410.7578" y2="410.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="295.5" y="405.6919">None</text><polygon fill="#A80036" points="439,435.8906,449,439.8906,439,443.8906,443,439.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="278.5" x2="445" y1="439.8906" y2="439.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="285.5" y="434.8247">save(user)</text><polygon fill="#A80036" points="733.5,465.0234,743.5,469.0234,733.5,473.0234,737.5,469.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="461" x2="739.5" y1="469.0234" y2="469.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="468" y="463.9575">INSERT</text><polygon fill="#A80036" points="472,479.0234,462,483.0234,472,487.0234,468,483.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="466" x2="749.5" y1="483.0234" y2="483.0234"/><polygon fill="#A80036" points="289.5,493.0234,279.5,497.0234,289.5,501.0234,285.5,497.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="283.5" x2="455" y1="497.0234" y2="497.0234"/><polygon fill="#A80036" points="613.5,522.1563,623.5,526.1563,613.5,530.1563,617.5,526.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="278.5" x2="619.5" y1="526.1563" y2="526.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="285.5" y="521.0903">send_verification(user)</text><polygon fill="#A80036" points="816,551.2891,826,555.2891,816,559.2891,820,555.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="635.5" x2="822" y1="555.2891" y2="555.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="642.5" y="550.2231">publish "send $email"</text><polygon fill="#A80036" points="289.5,565.2891,279.5,569.2891,289.5,573.2891,285.5,569.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="283.5" x2="629.5" y1="569.2891" y2="569.2891"/><polygon fill="#A80036" points="149,579.2891,139,583.2891,149,587.2891,145,583.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="143" x2="272.5" y1="583.2891" y2="583.2891"/><polygon fill="#A80036" points="53,608.4219,43,612.4219,53,616.4219,49,612.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47" x2="132" y1="612.4219" y2="612.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="59" y="607.356">Created</text><!--MD5=[71bc3cd1cdaefe6f1835c30fce16ffd8]
@startuml registration_sequence

actor User

participant WebServer
participant RegisterUserUsecase
participant PostgresUserRepoImpl
participant NotificationsService
database Postgres

queue Queue

User -> WebServer : POST data
activate WebServer

WebServer -> RegisterUserUsecase : create_user()
activate RegisterUserUsecase

RegisterUserUsecase -> PostgresUserRepoImpl : find_by_email()
activate PostgresUserRepoImpl

PostgresUserRepoImpl -> Postgres : SELECT WHERE
activate Postgres

break Пользователь уже существует

PostgresUserRepoImpl <- Postgres : 1 row

RegisterUserUsecase <- PostgresUserRepoImpl : Some(user)

WebServer <[#red]- RegisterUserUsecase : UserExistsError

User <- WebServer : Conflict

end

PostgresUserRepoImpl <- Postgres : 0 rows
deactivate Postgres

RegisterUserUsecase <- PostgresUserRepoImpl : None
deactivate PostgresUserRepoImpl

RegisterUserUsecase -> PostgresUserRepoImpl : save(user)
activate PostgresUserRepoImpl

PostgresUserRepoImpl -> Postgres : INSERT
activate Postgres

PostgresUserRepoImpl <- Postgres
deactivate Postgres

RegisterUserUsecase <- PostgresUserRepoImpl
deactivate PostgresUserRepoImpl

RegisterUserUsecase -> NotificationsService : send_verification(user)
activate NotificationsService

NotificationsService - -> Queue : publish "send $email"

RegisterUserUsecase <- NotificationsService
deactivate NotificationsService

WebServer <- RegisterUserUsecase
deactivate RegisterUserUsecase

User <- WebServer : Created
deactivate WebServer

@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 GMT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.9+11-Ubuntu-0ubuntu1
Operating System: Linux
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>